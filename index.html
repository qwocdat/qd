<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SUNWIN V17 - FIX BUTTON</title>
    <style>
        /* --- RESET --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; user-select: none; }
        body {
            background: #000; font-family: Arial, sans-serif;
            height: 100vh; width: 100vw; overflow: hidden;
            display: flex; flex-direction: column;
            background: radial-gradient(circle, #3a0e0e 0%, #000 100%);
        }

        /* --- 1. HEADER --- */
        .header {
            height: 50px; background: linear-gradient(to bottom, #d4af37, #aa8822);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; border-bottom: 2px solid #fff;
            flex-shrink: 0;
        }
        .balance {
            background: #000; color: #ffd700; padding: 5px 15px; border-radius: 20px;
            font-weight: bold; font-size: 16px; border: 1px solid #ffd700;
        }

        /* --- 2. BÀN CHƠI (Co giãn) --- */
        .game-area {
            flex: 1; position: relative; width: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding-bottom: 120px; /* Chừa chỗ cho nút đặt cược ở dưới */
        }

        .timer {
            font-size: 40px; font-weight: bold; color: red;
            text-shadow: 0 0 10px #000; margin-bottom: 10px;
        }

        .board {
            display: flex; width: 100%; justify-content: space-around; align-items: center;
        }

        .gate {
            width: 110px; height: 110px;
            background: #2a0a0a; border: 2px solid #b8860b; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .gate.active { background: #5a1e1e; border-color: #ffd700; box-shadow: 0 0 20px #ffd700; transform: scale(1.1); }
        .gate-txt { font-size: 30px; font-weight: 900; color: #fff; }
        .gate-bet { color: #ff0; font-size: 12px; margin-top: 5px; }

        .bowl-wrap {
            width: 130px; height: 130px; position: relative;
            display: flex; justify-content: center; align-items: center;
        }
        .plate {
            width: 100%; height: 100%; border-radius: 50%;
            background: #d4af37; border: 4px solid #fff;
        }
        .bowl {
            position: absolute; top: -5px; left: -5px; width: 110%; height: 110%;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border-radius: 50%; z-index: 10;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 20px; color: #5c3c0d;
            box-shadow: 0 10px 20px #000; transition: 0.5s;
        }
        .bowl.open { transform: translateY(-200px); opacity: 0; }
        .bowl.shaking { animation: shake 0.5s infinite; }

        .dices { position: absolute; z-index: 5; display: flex; gap: 5px; }
        .dice { width: 30px; height: 30px; background: #fff; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 20px; }

        /* --- 3. CONTROLS (CHIP) --- */
        .chip-bar {
            position: fixed; bottom: 60px; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            overflow-x: auto; gap: 10px; padding: 0 10px; z-index: 900;
        }
        .chip {
            min-width: 50px; height: 50px; border-radius: 50%;
            background: radial-gradient(#f1c40f, #d35400); border: 2px dashed #fff;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 11px; color: #000; flex-shrink: 0;
        }
        .chip:active { transform: scale(0.9); }

        /* --- 4. NÚT ĐẶT CƯỢC (GHIM CỨNG DƯỚI ĐÁY) --- */
        .action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            display: flex; z-index: 1000;
        }
        .btn-cancel {
            width: 30%; background: #555; color: #fff; font-weight: bold;
            border: none; border-top: 1px solid #fff; font-size: 16px;
        }
        .btn-confirm {
            width: 70%; background: linear-gradient(to right, #e67e22, #f1c40f);
            color: #2d1e03; font-weight: 900; font-size: 22px; text-transform: uppercase;
            border: none; border-top: 1px solid #fff;
        }
        .btn-confirm:active { background: #fff; }
        .btn-confirm.disabled { filter: grayscale(1); opacity: 0.8; color: #555; pointer-events: none; }

        /* Thông báo */
        #status {
            position: fixed; bottom: 130px; width: 100%; text-align: center;
            color: #fff; font-weight: bold; text-shadow: 1px 1px 0 #000; z-index: 800;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            50% { transform: translate(-1px, -2px) rotate(-2deg); }
            100% { transform: translate(1px, 2px) rotate(2deg); }
        }
    </style>
</head>
<body>

    <div class="header">
        <div style="color:#fff; font-weight:bold;">SUNWIN V17</div>
        <div class="balance" id="balance">50.000.000</div>
    </div>

    <div class="game-area">
        <div class="timer" id="timer">15</div>

        <div class="board">
            <div class="gate" id="gate-tai" onclick="game.select('TAI')">
                <div class="gate-txt">TÀI</div>
                <div class="gate-bet" id="bet-tai">0</div>
            </div>

            <div class="bowl-wrap">
                <div class="plate"></div>
                <div class="dices">
                    <div class="dice" id="d1">1</div>
                    <div class="dice" id="d2">2</div>
                    <div class="dice" id="d3">3</div>
                </div>
                <div class="bowl" id="bowl">VIP</div>
            </div>

            <div class="gate" id="gate-xiu" onclick="game.select('XIU')">
                <div class="gate-txt">XỈU</div>
                <div class="gate-bet" id="bet-xiu">0</div>
            </div>
        </div>
    </div>

    <div id="status">Vui lòng chọn cửa cược</div>

    <div class="chip-bar">
        <div class="chip" onclick="game.setChip(100000)">100K</div>
        <div class="chip" onclick="game.setChip(500000)">500K</div>
        <div class="chip" onclick="game.setChip(1000000)">1M</div>
        <div class="chip" onclick="game.setChip(5000000)">5M</div>
        <div class="chip" onclick="game.setChip(10000000)">10M</div>
    </div>

    <div class="action-bar">
        <button class="btn-cancel" onclick="game.cancel()">HỦY</button>
        <button class="btn-confirm" id="btn-ok" onclick="game.confirm()">ĐẶT CƯỢC</button>
    </div>

    <script>
        const game = {
            bal: 50000000,
            currChip: 100000,
            tempBet: 0,
            side: null,
            state: 'BET', // BET, SHAKE, RESULT
            timer: 15,
            interval: null,

            init: function() {
                this.updateBal();
                this.startRound();
            },

            startRound: function() {
                this.state = 'BET';
                this.timer = 15;
                this.tempBet = 0;
                this.side = null;
                
                // UI Reset
                document.getElementById('timer').innerText = this.timer;
                document.getElementById('bowl').classList.remove('open', 'shaking');
                document.getElementById('gate-tai').classList.remove('active');
                document.getElementById('gate-xiu').classList.remove('active');
                document.getElementById('bet-tai').innerText = "0";
                document.getElementById('bet-xiu').innerText = "0";
                document.getElementById('btn-ok').classList.remove('disabled');
                document.getElementById('btn-ok').innerText = "ĐẶT CƯỢC";
                document.getElementById('status').innerText = "VUI LÒNG CHỌN CỬA";

                clearInterval(this.interval);
                this.interval = setInterval(() => {
                    this.timer--;
                    document.getElementById('timer').innerText = this.timer;
                    if(this.timer <= 0) {
                        clearInterval(this.interval);
                        this.shake();
                    }
                }, 1000);
            },

            setChip: function(v) {
                this.currChip = v;
                document.getElementById('status').innerText = "Đang chọn chip: " + (v/1000) + "K";
            },

            select: function(s) {
                if(this.state !== 'BET') return;
                
                // Logic đơn giản: Mỗi lần bấm là cộng tiền vào
                this.side = s;
                if(this.bal >= this.currChip) {
                    this.tempBet += this.currChip;
                    this.bal -= this.currChip; // Trừ tiền hiển thị tạm
                    this.updateBal();

                    // Update UI
                    document.getElementById('gate-tai').classList.remove('active');
                    document.getElementById('gate-xiu').classList.remove('active');
                    
                    if(s === 'TAI') {
                        document.getElementById('gate-tai').classList.add('active');
                        document.getElementById('bet-tai').innerText = this.fmt(this.tempBet);
                    } else {
                        document.getElementById('gate-xiu').classList.add('active');
                        document.getElementById('bet-xiu').innerText = this.fmt(this.tempBet);
                    }
                    
                    document.getElementById('btn-ok').innerText = "CHỐT: " + this.fmt(this.tempBet);
                } else {
                    alert("Hết tiền rồi!");
                }
            },

            confirm: function() {
                if(this.tempBet > 0 && this.state === 'BET') {
                    // Đã chốt
                    document.getElementById('btn-ok').classList.add('disabled');
                    document.getElementById('btn-ok').innerText = "ĐÃ CƯỢC";
                    document.getElementById('status').innerText = "ĐÃ ĐẶT CƯỢC THÀNH CÔNG";
                }
            },

            cancel: function() {
                if(this.state === 'BET' && this.tempBet > 0) {
                    this.bal += this.tempBet; // Hoàn tiền
                    this.tempBet = 0;
                    this.side = null;
                    this.updateBal();
                    
                    document.getElementById('gate-tai').classList.remove('active');
                    document.getElementById('gate-xiu').classList.remove('active');
                    document.getElementById('bet-tai').innerText = "0";
                    document.getElementById('bet-xiu').innerText = "0";
                    document.getElementById('btn-ok').innerText = "ĐẶT CƯỢC";
                }
            },

            shake: function() {
                this.state = 'SHAKE';
                document.getElementById('btn-ok').classList.add('disabled');
                document.getElementById('bowl').classList.add('shaking');
                document.getElementById('status').innerText = "NHÀ CÁI ĐANG XÓC...";
                
                setTimeout(() => {
                    document.getElementById('bowl').classList.remove('shaking');
                    this.result();
                }, 2000);
            },

            result: function() {
                this.state = 'RESULT';
                
                // Random Dice
                let d1 = Math.ceil(Math.random()*6);
                let d2 = Math.ceil(Math.random()*6);
                let d3 = Math.ceil(Math.random()*6);
                let total = d1+d2+d3;
                let type = total > 10 ? 'TAI' : 'XIU';

                document.getElementById('d1').innerText = d1;
                document.getElementById('d2').innerText = d2;
                document.getElementById('d3').innerText = d3;

                document.getElementById('bowl').classList.add('open');
                document.getElementById('status').innerText = `KẾT QUẢ: ${total} - ${type}`;

                // Trả thưởng
                if(this.side === type && this.tempBet > 0) {
                    let win = this.tempBet * 2;
                    this.bal += win;
                    setTimeout(() => alert("BẠN THẮNG " + this.fmt(win)), 500);
                }

                this.updateBal();
                setTimeout(() => this.startRound(), 5000);
            },

            updateBal: function() {
                document.getElementById('balance').innerText = this.fmt(this.bal);
            },

            fmt: function(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
        };

        // Chạy ngay
        game.init();

    </script>
</body>
</html>
