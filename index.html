<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP KEY SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --main: #00ff88; --bg: #090909; --card: #151515; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        
        .container { 
            width: 380px; padding: 30px; background: var(--card); border-radius: 20px; 
            border: 1px solid #333; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
            position: relative;
        }
        
        h2 { color: var(--main); font-family: 'Orbitron'; margin-bottom: 5px; }
        p { color: #888; font-size: 13px; margin-bottom: 25px; }
        
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 10px;
            font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px;
            transition: 0.3s; text-transform: uppercase;
        }
        
        .btn-link { background: #333; color: #fff; border: 1px solid #444; }
        .btn-link:hover { background: #444; }
        
        .btn-gen { background: var(--main); color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
        .btn-gen:hover { transform: scale(1.02); }

        .key-area { display: none; margin-top: 20px; }
        .key-box { 
            background: #000; border: 2px dashed var(--main); color: var(--main); 
            font-family: 'Orbitron'; font-size: 28px; padding: 15px; 
            border-radius: 8px; margin-bottom: 10px; letter-spacing: 2px;
        }
        .timer { font-size: 14px; color: #aaa; }
        
        #step1, #step2 { display: none; }
        
        .loader {
            border: 4px solid #333; border-top: 4px solid var(--main);
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 10px auto; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <h2>H·ªÜ TH·ªêNG VIP</h2>
        <p>API Link4M Auto - No Error</p>

        <div id="step1">
            <button class="btn btn-link" onclick="getLinkAuto()">üëâ B·∫§M ƒê·ªÇ L·∫§Y LINK KEY</button>
            <div id="loading" class="loader"></div>
            <div id="statusText" style="font-size:12px; margin-top:10px; color:#ffff00; display:none;">ƒêang k·∫øt n·ªëi API...</div>
        </div>

        <div id="step2">
            <div style="color:#00ff88; margin-bottom:15px; font-weight:bold;">‚úÖ ƒê√£ v∆∞·ª£t link th√†nh c√¥ng!</div>
            <button class="btn btn-gen" onclick="startGen()">KH·ªûI T·∫†O KEY NGAY</button>
        </div>

        <div id="keyDisplayArea" class="key-area">
            <div class="key-box" id="finalKey">LOADING...</div>
            <div class="timer">Key ƒë·ªïi sau: <span id="timeCount" style="color:#fff">--</span>s</div>
            <button class="btn btn-link" onclick="copyKey()" style="margin-top:15px; font-size:12px;">Sao ch√©p</button>
        </div>
    </div>

    <script>
        // ===========================================
        // C·∫§U H√åNH API
        const SECRET = "QUOC_DAT_SECRET_KEY_2026"; 
        const API_TOKEN = "6992df868b3d1e423d1ab833"; // Token c·ªßa b·∫°n
        // ===========================================

        const urlParams = new URLSearchParams(window.location.search);
        const isVerified = urlParams.get('verify') === 'true';

        if (isVerified) {
            document.getElementById('step2').style.display = 'block';
        } else {
            document.getElementById('step1').style.display = 'block';
        }

        async function getLinkAuto() {
            // Ch·∫∑n ch·∫°y offline ƒë·ªÉ tr√°nh l·ªói ng·ªõ ng·∫©n
            if (window.location.protocol === 'file:') {
                alert("L·ªñI: B·∫°n ph·∫£i upload file n√†y l√™n GitHub Pages th√¨ API m·ªõi ho·∫°t ƒë·ªông!");
                return;
            }

            const btn = document.querySelector('.btn-link');
            const loader = document.getElementById('loading');
            const status = document.getElementById('statusText');

            btn.style.display = 'none';
            loader.style.display = 'block';
            status.style.display = 'block';

            // 1. T·∫°o link ƒë√≠ch: https://qwocdat.github.io/tx/?verify=true
            const currentUrl = window.location.href.split('?')[0];
            const targetUrl = currentUrl + "?verify=true";
            
            console.log("M·ª•c ti√™u r√∫t g·ªçn:", targetUrl);

            // 2. G·ªçi API Link4M qua Proxy (AllOrigins) ƒë·ªÉ tr√°nh l·ªói CORS
            // C√∫ ph√°p: Link4M API c·∫ßn tham s·ªë 'url' ƒë∆∞·ª£c encode
            const link4mApi = `https://link4m.com/api-shorten/v2?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`;
            
            // Proxy c≈©ng c·∫ßn tham s·ªë 'url' l√† link API ·ªü tr√™n (ƒë∆∞·ª£c encode l·∫ßn n·ªØa)
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(link4mApi)}`;

            try {
                const response = await fetch(proxyUrl);
                const dataWrapper = await response.json();
                
                if (dataWrapper.contents) {
                    const data = JSON.parse(dataWrapper.contents);
                    
                    if (data.status === "success" && data.shortenedUrl) {
                        status.innerText = "Th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...";
                        setTimeout(() => {
                            window.location.href = data.shortenedUrl;
                        }, 500);
                    } else {
                        // Link4M tr·∫£ v·ªÅ l·ªói (V√≠ d·ª•: t√™n mi·ªÅn b·ªã c·∫•m, token sai...)
                        throw new Error(data.message || "Kh√¥ng t·∫°o ƒë∆∞·ª£c link");
                    }
                } else {
                    throw new Error("L·ªói k·∫øt n·ªëi Proxy");
                }

            } catch (error) {
                console.error(error);
                alert("L·ªñI T·∫†O LINK: " + error.message + "\n\nH·ªá th·ªëng s·∫Ω m·ªü trang ch·ªß Link4M ƒë·ªÉ b·∫°n ki·ªÉm tra.");
                btn.style.display = 'block';
                loader.style.display = 'none';
                status.style.display = 'none';
                // Kh√¥ng t·ª± chuy·ªÉn h∆∞·ªõng lung tung ƒë·ªÉ tr√°nh l·ªói "No Alias"
            }
        }

        let interval;
        function startGen() {
            document.getElementById('step2').style.display = 'none';
            document.getElementById('keyDisplayArea').style.display = 'block';
            updateKey();
            interval = setInterval(updateKey, 1000);
        }

        function updateKey() {
            const now = Math.floor(Date.now() / 1000);
            const duration = 180; 
            const timeStep = Math.floor(now / duration);
            
            const raw = SECRET + timeStep;
            const hash = CryptoJS.MD5(raw).toString();
            const num = parseInt(hash.substring(0, 8), 16) % 10000;
            const key = "dat_" + num.toString().padStart(4, '0');
            
            document.getElementById("finalKey").innerText = key;
            document.getElementById("timeCount").innerText = duration - (now % duration);
        }

        function copyKey() {
            const k = document.getElementById("finalKey").innerText;
            navigator.clipboard.writeText(k);
            alert("ƒê√£ sao ch√©p: " + k);
        }
    </script>
</body>
</html>
