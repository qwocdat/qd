<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sunwin Final V8</title>
    <style>
        /* --- CSS --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; background: #000; font-family: Arial, sans-serif; overflow: hidden; height: 100vh; width: 100vw; }

        /* MÀN HÌNH CHỜ */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }
        #btn-start {
            padding: 20px 60px; font-size: 24px; font-weight: bold;
            background: #f1c40f; border: none; border-radius: 50px;
            box-shadow: 0 0 20px #f1c40f; animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* GIAO DIỆN CHÍNH */
        #game-app { display: none; height: 100%; width: 100%; flex-direction: column; }
        
        .header { height: 60px; background: #1a0505; border-bottom: 2px solid #b8860b; display: flex; justify-content: center; align-items: center; }
        .balance-box { 
            color: #f1c40f; font-weight: bold; font-size: 20px; 
            border: 1px solid #d4af37; padding: 5px 20px; border-radius: 20px; background: #000;
        }

        .board { flex: 1; background: radial-gradient(#3e0b0b, #000); position: relative; display: flex; align-items: center; justify-content: center; }
        
        /* CỬA CƯỢC */
        .gate-row { width: 95%; display: flex; justify-content: space-between; position: absolute; z-index: 10; }
        .gate {
            width: 35vw; height: 35vw; max-width: 140px; max-height: 140px;
            background: linear-gradient(180deg, #4b0d0d, #220505);
            border: 2px solid #6e4618; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.1s;
        }
        .gate.active { border-color: #f1c40f; box-shadow: 0 0 20px #f1c40f; transform: scale(1.05); }
        .gate-txt { font-size: 30px; font-weight: 900; color: #fff; }
        .gate.tai .gate-txt { text-shadow: 0 0 5px red; }
        .gate.xiu .gate-txt { text-shadow: 0 0 5px blue; }
        .gate-money { color: #2ecc71; font-weight: bold; font-size: 14px; margin-top: 5px; }

        /* ĐĨA & BÁT */
        .plate {
            width: 40vw; height: 40vw; max-width: 180px; max-height: 180px;
            background: #251600; border: 4px solid #d4af37; border-radius: 50%;
            position: relative; display: flex; justify-content: center; align-items: center; z-index: 5;
        }
        .bowl {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #f1c40f, #8a6d3b);
            z-index: 20; transition: transform 0.5s, opacity 0.5s;
            box-shadow: 0 5px 20px #000;
        }
        .bowl.open { transform: translateY(-150%); opacity: 0; pointer-events: none; }
        .shaking { animation: shake 0.5s infinite; }
        @keyframes shake { 0% {transform: translate(0,0);} 25% {transform: translate(-3px,3px);} 75% {transform: translate(3px,-3px);} }
        
        .dice-wrap { display: flex; gap: 5px; }
        .dice { width: 30px; height: 30px; background: #fff; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 20px; color: #c0392b; }
        .timer {
            position: absolute; top: -15px; width: 40px; height: 40px; background: #000;
            border: 2px solid red; color: red; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-weight: bold; z-index: 30;
        }

        /* CONTROLS */
        .controls {
            background: #111; border-top: 2px solid #b8860b; padding: 10px;
            display: flex; flex-direction: column; gap: 10px; align-items: center;
        }
        .chip-row { display: flex; gap: 10px; width: 100%; overflow-x: auto; padding-bottom: 5px; justify-content: center;}
        .chip {
            flex-shrink: 0; width: 50px; height: 50px; border-radius: 50%;
            background: radial-gradient(#e67e22, #d35400); border: 2px dashed #fff;
            display: flex; justify-content: center; align-items: center; font-size: 10px; font-weight: bold;
        }
        .actions { display: flex; width: 100%; gap: 10px; }
        .btn { flex: 1; padding: 15px; border-radius: 25px; border: none; font-weight: 900; font-size: 16px; color: #000; }
        .btn-cancel { background: #95a5a6; flex: 0.5; }
        .btn-allin { background: linear-gradient(to right, #e74c3c, #c0392b); color: #fff; }
        .btn-ok { background: linear-gradient(to right, #f1c40f, #f39c12); flex: 1.5; }
        .btn:disabled { opacity: 0.5; filter: grayscale(1); }

        /* EFFECT LAYER */
        #fx-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; }
        .fly-chip { position: absolute; width: 30px; height: 30px; background: orange; border-radius: 50%; z-index: 900; transition: all 0.5s; }
        .float-txt { position: absolute; font-weight: bold; font-size: 24px; animation: float 1s forwards; z-index: 901; }
        @keyframes float { to { transform: translateY(-50px); opacity: 0; } }

        /* TOOL */
        #tool-trigger { position: fixed; bottom: 180px; right: 10px; width: 50px; height: 50px; background: #000; border: 2px solid #0f0; border-radius: 50%; color: #0f0; display: flex; justify-content: center; align-items: center; z-index: 100; font-size: 24px; }
        #tool-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .tool-box { width: 80%; background: #000; border: 2px solid #0f0; padding: 20px; text-align: center; }

    </style>
</head>
<body>

    <div id="loading-screen">
        <h2 style="color: #f1c40f; margin-bottom: 20px;">SUNWIN V8</h2>
        <button id="btn-start">VÀO GAME NGAY</button>
        <div id="error-log" style="color:red; margin-top:20px; font-size:12px;"></div>
    </div>

    <div id="game-app">
        <div class="header">
            <div class="balance-box" id="balance">10,000,000</div>
        </div>

        <div class="board">
            <div id="win-msg" style="position:absolute; top:20%; color:yellow; font-size:40px; font-weight:900; text-shadow:0 0 20px red; display:none; z-index:100">BIG WIN</div>

            <div class="gate-row">
                <div class="gate" id="gate-tai">
                    <div class="gate-txt">TÀI</div>
                    <div class="gate-money" id="bet-tai">0</div>
                </div>
                <div class="gate" id="gate-xiu">
                    <div class="gate-txt">XỈU</div>
                    <div class="gate-money" id="bet-xiu">0</div>
                </div>
            </div>

            <div class="plate">
                <div class="timer" id="timer">15</div>
                <div class="dice-wrap">
                    <div class="dice" id="d1">1</div>
                    <div class="dice" id="d2">2</div>
                    <div class="dice" id="d3">3</div>
                </div>
                <div class="bowl" id="bowl"></div>
            </div>
        </div>

        <div class="controls">
            <div id="status" style="color:#f39c12; font-weight:bold">Chọn cửa đặt cược</div>
            <div class="chip-row">
                <div class="chip" data-val="100000">100K</div>
                <div class="chip" data-val="500000">500K</div>
                <div class="chip" data-val="1000000">1M</div>
                <div class="chip" data-val="5000000">5M</div>
                <div class="chip" data-val="10000000">10M</div>
            </div>
            <div class="actions">
                <button class="btn btn-cancel" id="btn-cancel">HỦY</button>
                <button class="btn btn-allin" id="btn-allin">ALL IN</button>
                <button class="btn btn-ok" id="btn-ok">CƯỢC</button>
            </div>
        </div>
    </div>

    <div id="fx-layer"></div>

    <div id="tool-trigger">⚙</div>
    <div id="tool-modal">
        <div class="tool-box">
            <div style="text-align:right; color:#fff; font-size:20px" id="close-tool">X</div>
            <div style="color:#0f0; margin-bottom:10px">HACKER SERVER</div>
            <div style="font-size:40px; font-weight:bold; color:#fff" id="hack-res">---</div>
            <button id="btn-hack" style="width:100%; padding:10px; margin-top:10px; background:#0f0; border:none; font-weight:bold">PHÂN TÍCH</button>
        </div>
    </div>

    <script>
        // --- HỆ THỐNG BẮT LỖI TOÀN CỤC ---
        window.onerror = function(msg, url, line) {
            document.getElementById('error-log').innerText = "Lỗi: " + msg + " (Dòng " + line + ")";
            alert("Có lỗi xảy ra: " + msg);
        };

        // --- KHỞI CHẠY KHI DOM SẴN SÀNG ---
        document.addEventListener('DOMContentLoaded', function() {
            
            // 1. VARIABLES
            let balance = 10000000;
            let gameState = 'STOP'; 
            let timeLeft = 15;
            let timerInt = null;
            let tempBet = 0;
            let selectedSide = null;
            let confirmedSide = null;
            let confirmedAmt = 0;
            let forcedResult = null; // Hack result

            const diceChars = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'];

            // 2. DOM ELEMENTS
            const uiLoad = document.getElementById('loading-screen');
            const uiApp = document.getElementById('game-app');
            const elBal = document.getElementById('balance');
            const elTimer = document.getElementById('timer');
            const elBowl = document.getElementById('bowl');
            const elStatus = document.getElementById('status');
            const elWin = document.getElementById('win-msg');
            
            const gateTai = document.getElementById('gate-tai');
            const gateXiu = document.getElementById('gate-xiu');
            const txtBetTai = document.getElementById('bet-tai');
            const txtBetXiu = document.getElementById('bet-xiu');

            // 3. EVENT LISTENERS (QUAN TRỌNG)
            
            // Nút Start
            document.getElementById('btn-start').addEventListener('click', function() {
                uiLoad.style.display = 'none';
                uiApp.style.display = 'flex';
                newRound();
            });

            // Chọn cửa
            gateTai.addEventListener('click', () => selectSide('TAI'));
            gateXiu.addEventListener('click', () => selectSide('XIU'));

            // Chọn chip
            document.querySelectorAll('.chip').forEach(c => {
                c.addEventListener('click', function() {
                    addChip(parseInt(this.getAttribute('data-val')), this);
                });
            });

            // Action Buttons
            document.getElementById('btn-cancel').addEventListener('click', () => {
                if(confirmedSide) return;
                tempBet = 0; updateUI();
            });

            document.getElementById('btn-allin').addEventListener('click', function() {
                if(gameState !== 'BETTING' || confirmedSide || !selectedSide) return;
                let avail = balance - confirmedAmt;
                if(avail > 0) {
                    tempBet = avail;
                    updateUI();
                    // Fake effect source
                    flyChip(this, selectedSide === 'TAI' ? gateTai : gateXiu);
                }
            });

            document.getElementById('btn-ok').addEventListener('click', confirmBet);

            // Tool Logic
            document.getElementById('tool-trigger').addEventListener('click', () => {
                document.getElementById('tool-modal').style.display = 'flex';
            });
            document.getElementById('close-tool').addEventListener('click', () => {
                document.getElementById('tool-modal').style.display = 'none';
            });
            document.getElementById('btn-hack').addEventListener('click', () => {
                if(gameState !== 'BETTING') return;
                const r = Math.random() > 0.5 ? 'TAI' : 'XIU';
                forcedResult = r;
                const resEl = document.getElementById('hack-res');
                resEl.innerText = r;
                resEl.style.color = r === 'TAI' ? '#e74c3c' : '#3498db';
            });


            // 4. GAME LOGIC FUNCTIONS

            function newRound() {
                gameState = 'BETTING';
                timeLeft = 15;
                tempBet = 0;
                selectedSide = null;
                confirmedSide = null;
                confirmedAmt = 0;
                forcedResult = null;
                
                clearInterval(timerInt);
                
                // UI Reset
                elBowl.classList.remove('open');
                elWin.style.display = 'none';
                elStatus.innerText = "MỜI ĐẶT CƯỢC";
                document.getElementById('btn-ok').disabled = false;
                document.getElementById('btn-allin').disabled = false;
                gateTai.classList.remove('active');
                gateXiu.classList.remove('active');
                updateUI();
                document.getElementById('hack-res').innerText = "---";

                timerInt = setInterval(() => {
                    timeLeft--;
                    elTimer.innerText = timeLeft;
                    if(timeLeft <= 0) {
                        clearInterval(timerInt);
                        startShaking();
                    }
                }, 1000);
            }

            function selectSide(side) {
                if(gameState !== 'BETTING' || confirmedSide) return;
                selectedSide = side;
                tempBet = 0; // Reset temp when switching
                updateUI();
            }

            function addChip(val, elSrc) {
                if(gameState !== 'BETTING' || confirmedSide || !selectedSide) return;
                if(balance - confirmedAmt - tempBet < val) return;
                tempBet += val;
                updateUI();
                flyChip(elSrc, selectedSide === 'TAI' ? gateTai : gateXiu);
            }

            function confirmBet() {
                if(tempBet <= 0) return;
                balance -= tempBet;
                confirmedAmt = tempBet;
                confirmedSide = selectedSide;
                
                elStatus.innerText = "ĐÃ ĐẶT CƯỢC";
                document.getElementById('btn-ok').disabled = true;
                document.getElementById('btn-allin').disabled = true;
                
                updateUI();
                showFloatText(document.getElementById('balance'), `-${fmt(tempBet)}`, 'red');
            }

            function startShaking() {
                gameState = 'SHAKING';
                elStatus.innerText = "ĐANG LẮC...";
                document.getElementById('btn-ok').disabled = true;
                document.getElementById('btn-allin').disabled = true;
                elBowl.classList.add('shaking');
                setTimeout(() => {
                    elBowl.classList.remove('shaking');
                    showResult();
                }, 2000);
            }

            function showResult() {
                gameState = 'RESULT';
                let total, r1, r2, r3, type;

                // Hack logic
                if(forcedResult) {
                    type = forcedResult;
                    do {
                        r1 = Math.ceil(Math.random()*6);
                        r2 = Math.ceil(Math.random()*6);
                        r3 = Math.ceil(Math.random()*6);
                        total = r1+r2+r3;
                    } while( (type==='TAI' && total<11) || (type==='XIU' && total>10) );
                } else {
                    r1 = Math.ceil(Math.random()*6);
                    r2 = Math.ceil(Math.random()*6);
                    r3 = Math.ceil(Math.random()*6);
                    total = r1+r2+r3;
                    type = total >= 11 ? 'TAI' : 'XIU';
                }

                document.getElementById('d1').innerText = diceChars[r1-1];
                document.getElementById('d2').innerText = diceChars[r2-1];
                document.getElementById('d3').innerText = diceChars[r3-1];
                
                elBowl.classList.add('open');
                elStatus.innerText = `KẾT QUẢ: ${type} (${total})`;

                if(confirmedSide === type) {
                    let win = confirmedAmt * 2;
                    balance += win;
                    elWin.style.display = 'block';
                    showFloatText(gateTai, `+${fmt(win)}`, 'green');
                }

                updateUI();
                setTimeout(newRound, 5000);
            }

            function updateUI() {
                elBal.innerText = fmt(balance);
                
                gateTai.classList.remove('active');
                gateXiu.classList.remove('active');
                txtBetTai.innerText = "0";
                txtBetXiu.innerText = "0";

                if(selectedSide === 'TAI') {
                    gateTai.classList.add('active');
                    txtBetTai.innerText = fmt(tempBet);
                } else if(selectedSide === 'XIU') {
                    gateXiu.classList.add('active');
                    txtBetXiu.innerText = fmt(tempBet);
                }
            }

            // --- EFFECTS ---
            function fmt(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

            function flyChip(src, dest) {
                const r1 = src.getBoundingClientRect();
                const r2 = dest.getBoundingClientRect();
                const c = document.createElement('div');
                c.className = 'fly-chip';
                c.style.left = r1.left + 'px';
                c.style.top = r1.top + 'px';
                document.getElementById('fx-layer').appendChild(c);
                
                setTimeout(() => {
                    c.style.left = (r2.left + r2.width/2) + 'px';
                    c.style.top = (r2.top + r2.height/2) + 'px';
                    c.style.opacity = 0;
                }, 10);
                setTimeout(() => c.remove(), 500);
            }

            function showFloatText(el, txt, color) {
                const r = el.getBoundingClientRect();
                const t = document.createElement('div');
                t.className = 'float-txt';
                t.innerText = txt;
                t.style.color = color === 'red' ? '#e74c3c' : '#2ecc71';
                t.style.left = r.left + 'px';
                t.style.top = r.top + 'px';
                document.getElementById('fx-layer').appendChild(t);
                setTimeout(() => t.remove(), 1000);
            }

        });
    </script>
</body>
</html>
