<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªÜ TH·ªêNG VIP KEY</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        .box { width: 380px; padding: 30px; border: 1px solid #333; border-radius: 20px; background: #111; text-align: center; box-shadow: 0 0 50px rgba(0,255,136,0.1); }
        h2 { color: #00ff88; font-family: 'Orbitron'; margin-bottom: 5px; }
        
        .btn { width: 100%; padding: 15px; background: #fff; color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .btn:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(255,255,255,0.4); }
        .btn-manual { background: #ff5555; color: #fff; display: none; margin-top: 15px; } /* N√∫t d·ª± ph√≤ng */

        /* Thanh ti·∫øn tr√¨nh Proxy */
        .progress-box { width: 100%; height: 6px; background: #333; border-radius: 3px; margin-top: 20px; overflow: hidden; display: none; }
        .progress-bar { width: 0%; height: 100%; background: #00ff88; transition: width 0.3s; }

        .status { color: #ffff00; font-size: 12px; margin-top: 10px; display: none; font-family: monospace; }
        .server-name { color: #888; font-size: 10px; margin-top: 5px; display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h2>VIP SYSTEM</h2>
        <p style="color:#666; font-size:12px">Multi-Proxy System (15 Server)</p>
        
        <button id="btnGet" class="btn" onclick="processKey()">üöÄ L·∫§Y LINK (AUTO PROXY)</button>
        
        <div id="pBox" class="progress-box"><div id="pBar" class="progress-bar"></div></div>
        
        <div id="status" class="status">ƒêang kh·ªüi t·∫°o...</div>
        <div id="serverName" class="server-name">...</div>

        <button id="btnManual" class="btn btn-manual" onclick="manualLink()">üõ†Ô∏è B·∫§M ƒê·ªÇ T·∫†O TH·ª¶ C√îNG</button>
    </div>

    <script>
        const API_TOKEN = "6992df868b3d1e423d1ab833"; 
        const TARGET_FILE = "key.html"; 
        
        let finalTargetUrl = "";

        // --- DANH S√ÅCH 15 PROXY M·∫†NH NH·∫§T (C·∫≠p nh·∫≠t 2026) ---
        // H·ªá th·ªëng s·∫Ω th·ª≠ l·∫ßn l∆∞·ª£t t·ª´ tr√™n xu·ªëng d∆∞·ªõi
        const PROXY_LIST = [
            u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`, // 1. AllOrigins (R·∫•t ·ªïn ƒë·ªãnh)
            u => `https://corsproxy.io/?${encodeURIComponent(u)}`,             // 2. CorsProxy.io (Nhanh)
            u => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`, // 3. CodeTabs (Ch√¢u √Çu)
            u => `https://thingproxy.freeboard.io/fetch/${u}`,                  // 4. ThingProxy
            u => `https://api.cors.lol/?url=${encodeURIComponent(u)}`,          // 5. Cors.lol
            u => `https://proxy.cors.sh/${u}`,                                  // 6. Cors.sh
            u => `https://cors-anywhere.herokuapp.com/${u}`,                    // 7. Heroku (C·∫ßn demo nh∆∞ng c·ª© th·ª≠)
            u => `https://api.incolumitas.com/?url=${encodeURIComponent(u)}`,   // 8. Incolumitas
            u => `https://cors.eu.org/${u}`,                                    // 9. EU Org
            u => `https://test.cors.workers.dev/?${encodeURIComponent(u)}`,     // 10. Cloudflare Worker Test
            u => `https://cors-get-proxy.sirjosh.workers.dev/?url=${encodeURIComponent(u)}`, // 11. SirJosh Worker
            u => `https://jsonp.afeld.me/?url=${encodeURIComponent(u)}`,        // 12. JSONP
            u => `https://yacdn.org/proxy/${u}`,                                // 13. YACDN
            u => `https://api.scraperapi.com/?api_key=your_key&url=${encodeURIComponent(u)}`, // 14. (Placeholder)
            u => u // 15. Th·ª≠ k·∫øt n·ªëi tr·ª±c ti·∫øp (N·∫øu m·∫°ng ng∆∞·ªùi d√πng cho ph√©p)
        ];

        async function processKey() {
            if (window.location.protocol === 'file:') return alert("L·ªói: H√£y upload l√™n GitHub Pages!");

            const btn = document.getElementById('btnGet');
            const pBox = document.getElementById('pBox');
            const pBar = document.getElementById('pBar');
            const status = document.getElementById('status');
            const sName = document.getElementById('serverName');
            const btnManual = document.getElementById('btnManual');

            // Reset giao di·ªán
            btn.style.display = 'none';
            btnManual.style.display = 'none';
            pBox.style.display = 'block';
            status.style.display = 'block';
            sName.style.display = 'block';
            status.innerText = "ƒêang sinh m√£ b·∫£o m·∫≠t...";
            pBar.style.width = "5%";

            try {
                // 1. T·∫°o Token b·∫£o m·∫≠t
                const token = Math.random().toString(36).substring(2) + Date.now().toString(36);
                const expiry = Date.now() + (15 * 60 * 1000); // 15 ph√∫t
                
                localStorage.setItem('secure_token', token);
                localStorage.setItem('secure_expiry', expiry);

                // 2. T·∫°o Link ƒê√≠ch
                let path = window.location.href.split('?')[0];
                if (path.endsWith("index.html")) path = path.substring(0, path.lastIndexOf("index.html"));
                if (!path.endsWith("/")) path += "/";
                
                finalTargetUrl = `${path}${TARGET_FILE}?t=${token}&e=${expiry}`;

                // 3. CH·∫†Y V√íNG L·∫∂P TH·ª¨ PROXY
                const api = `https://link4m.co/api-shorten/v2?api=${API_TOKEN}&url=${encodeURIComponent(finalTargetUrl)}`;
                let shortLink = null;

                for (let i = 0; i < PROXY_LIST.length; i++) {
                    const progress = Math.round(((i + 1) / PROXY_LIST.length) * 100);
                    pBar.style.width = `${progress}%`;
                    
                    status.innerText = `ƒêang th·ª≠ Server ${i + 1}/${PROXY_LIST.length}...`;
                    sName.innerText = `Connecting: Proxy Node ${i+1}`;
                    
                    try {
                        // Timeout 3 gi√¢y m·ªói server ƒë·ªÉ kh√¥ng ƒë·ª£i l√¢u
                        const controller = new AbortController();
                        const id = setTimeout(() => controller.abort(), 3500);
                        
                        const res = await fetch(PROXY_LIST[i](api), { signal: controller.signal });
                        clearTimeout(id);

                        if (res.ok) {
                            // C·ªë g·∫Øng parse JSON
                            const text = await res.text();
                            try {
                                const data = JSON.parse(text);
                                if (data.status === "success") {
                                    shortLink = data.shortenedUrl;
                                    break; // TH√ÄNH C√îNG -> THO√ÅT V√íNG L·∫∂P NGAY
                                }
                            } catch(e) {}
                        }
                    } catch (e) {
                        console.log(`Server ${i+1} fail.`);
                    }
                    // Ngh·ªâ 100ms gi·ªØa c√°c l·∫ßn th·ª≠ ƒë·ªÉ m∆∞·ª£t
                    await new Promise(r => setTimeout(r, 100));
                }

                if (shortLink) {
                    pBar.style.width = "100%";
                    pBar.style.background = "#00ff88";
                    status.innerText = "‚úÖ TH√ÄNH C√îNG! ƒêANG CHUY·ªÇN H∆Ø·ªöNG...";
                    status.style.color = "#00ff88";
                    setTimeout(() => window.location.href = shortLink, 1000);
                } else {
                    throw new Error("T·∫•t c·∫£ Server ƒë·ªÅu b·∫≠n");
                }

            } catch (err) {
                // --- CH·∫æ ƒê·ªò D·ª∞ PH√íNG ---
                pBox.style.display = 'none';
                status.innerText = "‚ö†Ô∏è Server qu√° t·∫£i. Vui l√≤ng t·∫°o th·ªß c√¥ng.";
                status.style.color = "#ff5555";
                sName.style.display = 'none';
                
                btnManual.style.display = 'block';
            }
        }

        function manualLink() {
            const manualUrl = `https://link4m.co/api?api=${API_TOKEN}&url=${encodeURIComponent(finalTargetUrl)}`;
            window.open(manualUrl, '_blank');
        }
    </script>
</body>
</html>
