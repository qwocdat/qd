<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>KEY GENERATOR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'SF Pro Display', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { width: 360px; background: #1c1c1e; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid #333; }
        h2 { font-family: 'Orbitron'; margin-bottom: 20px; }
        
        .segment { background: #2c2c2e; padding: 3px; border-radius: 8px; display: flex; margin-bottom: 30px; }
        .seg-btn { flex: 1; padding: 8px; text-align: center; cursor: pointer; border-radius: 6px; font-size: 13px; color: #888; transition: 0.3s; }
        .seg-btn.active { background: #00ff88; color: #000; font-weight: bold; }
        .seg-btn.active-down { background: #00b8ff; color: #fff; font-weight: bold; }

        .btn-get { width: 100%; padding: 15px; background: #00ff88; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .btn-get.blue { background: #00b8ff; color: #fff; }
        
        .loader { width: 20px; height: 20px; border: 3px solid rgba(0,0,0,0.3); border-top: 3px solid #000; border-radius: 50%; animation: spin 1s infinite; margin: 0 auto; display: none; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="card">
        <h2>KEY GEN</h2>
        <div class="segment">
            <div id="btnTool" class="seg-btn active" onclick="setType('tool')">Tool Python</div>
            <div id="btnDown" class="seg-btn" onclick="setType('down')">Unlock Link</div>
        </div>
        <p id="desc" style="color:#aaa; font-size:13px; margin-bottom:20px; min-height:40px;">Key dùng cho Tool Obfuscator (dat_xxxx)</p>
        
        <button id="mainBtn" class="btn-get" onclick="process()">
            <span id="btnTxt">TẠO LINK</span><div id="load" class="loader"></div>
        </button>
        <div id="status" style="margin-top:15px; font-size:12px; color:#666;"></div>
        <button onclick="manual()" style="background:none; border:none; color:#ff5555; text-decoration:underline; margin-top:10px; cursor:pointer; font-size:12px;">Link lỗi? Tạo thủ công</button>
    </div>

    <script>
        let type = 'tool';
        const API = "6992df868b3d1e423d1ab833";
        let finalUrl = "";

        function setType(t) {
            type = t;
            if(t === 'tool') {
                document.getElementById('btnTool').className = 'seg-btn active';
                document.getElementById('btnDown').className = 'seg-btn';
                document.getElementById('desc').innerText = "Key dùng cho Tool Obfuscator (dat_xxxx)";
                document.getElementById('mainBtn').className = 'btn-get';
            } else {
                document.getElementById('btnTool').className = 'seg-btn';
                document.getElementById('btnDown').className = 'seg-btn active-down';
                document.getElementById('desc').innerText = "Key mở khóa file trong Shop (quocdat_xxxx)";
                document.getElementById('mainBtn').className = 'btn-get blue';
            }
        }

        async function process() {
            const btnTxt = document.getElementById('btnTxt');
            const load = document.getElementById('load');
            const status = document.getElementById('status');
            
            btnTxt.style.display = 'none'; load.style.display = 'block'; status.innerText = "Đang xử lý...";

            const token = Math.random().toString(36).substring(2) + Date.now().toString(36);
            const expiry = Date.now() + (15*60*1000);
            localStorage.setItem('secure_token', token);

            let path = window.location.href.split('?')[0];
            path = path.substring(0, path.lastIndexOf("/")+1);
            finalUrl = `${path}key.html?t=${token}&e=${expiry}&ktype=${type}`;

            // Proxy giả lập để tránh lỗi CORS trên GitHub Pages
            const api = `https://link4m.co/api-shorten/v2?api=${API}&url=${encodeURIComponent(finalUrl)}`;
            const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(api)}`;

            try {
                const res = await fetch(proxy);
                const data = await res.json();
                if(data.status === "success") {
                    status.innerText = "Thành công!";
                    window.location.href = data.shortenedUrl;
                } else throw "Error";
            } catch(e) {
                status.innerText = "Lỗi Auto. Vui lòng bấm 'Tạo thủ công'";
                load.style.display = 'none'; btnTxt.style.display = 'block';
            }
        }
        function manual() { window.open(`https://link4m.co/api?api=${API}&url=${encodeURIComponent(finalUrl)}`, '_blank'); }
    </script>
</body>
</html>
