<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG VIP KEY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* CSS GIAO DI·ªÜN DARK MODE */
        body { background: #050505; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        .box { 
            text-align: center; width: 380px; padding: 30px; 
            border: 1px solid #333; border-radius: 20px; 
            background: linear-gradient(145deg, #111, #0a0a0a); 
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.1); 
            position: relative; 
        }

        h2 { color: #00ff88; font-family: 'Orbitron'; margin-bottom: 5px; text-shadow: 0 0 10px rgba(0,255,136,0.5); }
        .sub-text { color: #666; font-size: 12px; margin-bottom: 25px; }

        /* BUTTON STYLE */
        .btn { 
            width: 100%; padding: 15px; border: none; border-radius: 12px; 
            font-weight: bold; cursor: pointer; text-transform: uppercase; 
            font-size: 14px; transition: all 0.3s; margin-top: 10px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-link { background: #fff; color: #000; box-shadow: 0 5px 15px rgba(255,255,255,0.1); }
        .btn-link:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255,255,255,0.2); }
        .btn-copy { background: #00ff88; color: #000; box-shadow: 0 5px 15px rgba(0,255,136,0.2); }
        .btn-copy:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,255,136,0.4); }

        /* THANH LOADING (PROGRESS BAR) */
        .progress-container {
            width: 100%; background: #222; height: 10px; border-radius: 5px;
            margin-top: 20px; overflow: hidden; display: none; position: relative;
        }
        .progress-bar {
            height: 100%; background: linear-gradient(90deg, #00ff88, #00b8ff);
            width: 0%; transition: width 0.4s ease-in-out;
            box-shadow: 0 0 10px #00ff88;
        }
        .status-text {
            color: #ffff00; font-size: 12px; margin-top: 10px; 
            display: none; font-family: monospace;
        }

        /* KEY DISPLAY & ERROR */
        #step2 { display: none; animation: fadeIn 0.5s; }
        .key-display { 
            font-family: 'Orbitron'; font-size: 28px; color: #00ff88; 
            background: rgba(0, 255, 136, 0.05); border: 2px dashed #333; 
            padding: 15px; margin: 20px 0; border-radius: 10px; letter-spacing: 3px; 
        }
        .timer { font-size: 13px; color: #888; }
        
        .error-box { 
            color: #ff5555; font-size: 12px; margin-top: 15px; 
            padding: 12px; border: 1px solid #ff5555; border-radius: 8px;
            background: rgba(255,0,0,0.1); display: none; word-wrap: break-word; 
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="box">
        <h2>VIP SYSTEM</h2>
        <p class="sub-text">H·ªá th·ªëng t·∫°o Link4M t·ª± ƒë·ªông v5.0</p>

        <div id="step1">
            <button id="btnGet" class="btn btn-link" onclick="handleGetLink()">
                <span>üöÄ</span> B·∫§M ƒê·ªÇ L·∫§Y KEY
            </button>
            
            <div id="progressBox" class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="status" class="status-text">ƒêang kh·ªüi t·∫°o...</div>
            <div id="errorDisplay" class="error-box"></div>
        </div>

        <div id="step2">
            <div style="color:#00ff88; font-weight:bold; font-size:14px; margin-bottom:10px;">‚úÖ X√ÅC MINH TH√ÄNH C√îNG</div>
            <div class="key-display" id="finalKey">LOADING...</div>
            <div class="timer">Key ƒë·ªïi sau: <span id="timeCount" style="color:#fff">--</span>s</div>
            <button class="btn btn-copy" onclick="copyKey()">SAO CH√âP KEY</button>
        </div>
    </div>

    <script>
        // ==========================================
        // C·∫§U H√åNH API
        const SECRET = "QUOC_DAT_SECRET_KEY_2026"; 
        const API_TOKEN = "6992df868b3d1e423d1ab833"; 
        const TARGET_FILE = "key.html"; 
        // ==========================================

        // DANH S√ÅCH 10 C·ªîNG K·∫æT N·ªêI (PROXY) M·∫†NH NH·∫§T
        // H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông nh·∫£y qua server kh√°c n·∫øu server tr∆∞·ªõc b·ªã l·ªói
        const PROXY_LIST = [
            (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`, // Server M·ªπ (·ªîn ƒë·ªãnh)
            (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`,             // Server Cloudflare (Nhanh)
            (u) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`, // Server Ch√¢u √Çu
            (u) => `https://thingproxy.freeboard.io/fetch/${u}`,                  // Server D·ª± ph√≤ng 1
            (u) => `https://api.cors.lol/?url=${encodeURIComponent(u)}`,          // Server D·ª± ph√≤ng 2
            (u) => `https://cors-anywhere.herokuapp.com/${u}`,                    // Server D·ª± ph√≤ng 3
            (u) => `https://proxy.cors.sh/${u}`,                                  // Server D·ª± ph√≤ng 4
            // Th·ª≠ k·∫øt n·ªëi tr·ª±c ti·∫øp (N·∫øu m·∫°ng ng∆∞·ªùi d√πng cho ph√©p)
            (u) => u 
        ];

        // --- KI·ªÇM TRA TR·∫†NG TH√ÅI V∆Ø·ª¢T LINK ---
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('verify') === 'true') {
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            startKeyGen();
        }

        // --- H√ÄM X·ª¨ L√ù CH√çNH ---
        async function handleGetLink() {
            // Ch·∫∑n ch·∫°y offline
            if (window.location.protocol === 'file:') {
                showError("‚ö†Ô∏è L·ªói: B·∫°n ƒëang ch·∫°y file tr√™n m√°y. H√£y upload l√™n GitHub Pages!");
                return;
            }

            const btn = document.getElementById('btnGet');
            const progressBox = document.getElementById('progressBox');
            const progressBar = document.getElementById('progressBar');
            const status = document.getElementById('status');
            const errBox = document.getElementById('errorDisplay');

            // Reset giao di·ªán
            btn.style.display = 'none';
            errBox.style.display = 'none';
            progressBox.style.display = 'block';
            status.style.display = 'block';
            progressBar.style.width = '5%';

            // 1. T·∫°o Link ƒê√≠ch
            let currentPath = window.location.href.split('?')[0];
            if (currentPath.endsWith("index.html")) currentPath = currentPath.substring(0, currentPath.lastIndexOf("index.html"));
            if (!currentPath.endsWith("/")) currentPath += "/";
            const targetUrl = currentPath + TARGET_FILE;

            // Link API g·ªëc Link4M (.co)
            const link4mApi = `https://link4m.co/api-shorten/v2?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`;
            
            // 2. CH·∫†Y V√íNG L·∫∂P TH·ª¨ C√ÅC PROXY
            let success = false;
            
            for (let i = 0; i < PROXY_LIST.length; i++) {
                // T√≠nh ph·∫ßn trƒÉm load
                const percent = Math.round(((i + 1) / PROXY_LIST.length) * 100);
                progressBar.style.width = `${percent}%`;
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i text
                status.innerText = `ƒêang k·∫øt n·ªëi Server ${i + 1} / ${PROXY_LIST.length}...`;
                
                try {
                    const proxyUrl = PROXY_LIST[i](link4mApi);
                    
                    // G·ªçi API (Timeout 5 gi√¢y m·ªói server ƒë·ªÉ kh√¥ng ƒë·ª£i l√¢u)
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(proxyUrl, { signal: controller.signal });
                    clearTimeout(timeoutId);

                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    // X·ª≠ l√Ω d·ªØ li·ªáu tr·∫£ v·ªÅ
                    const textData = await response.text();
                    let data;
                    try {
                        data = JSON.parse(textData); // Th·ª≠ parse JSON
                    } catch {
                        // N·∫øu response l√† HTML (l·ªói 403 t·ª´ proxy), b·ªè qua
                        throw new Error("Ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá");
                    }

                    if (data.status === "success" && data.shortenedUrl) {
                        // === TH√ÄNH C√îNG ===
                        progressBar.style.width = '100%';
                        progressBar.style.background = '#00ff88';
                        status.innerText = "‚úÖ ƒê√£ t·∫°o link th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...";
                        status.style.color = "#00ff88";
                        
                        setTimeout(() => {
                            window.location.href = data.shortenedUrl;
                        }, 800); // ƒê·ª£i x√≠u cho ƒë·∫πp
                        
                        success = true;
                        break; // Tho√°t v√≤ng l·∫∑p
                    }

                } catch (err) {
                    console.warn(`Server ${i+1} th·∫•t b·∫°i.`);
                }
                
                // Ngh·ªâ 300ms gi·ªØa c√°c l·∫ßn th·ª≠ ƒë·ªÉ hi·ªáu ·ª©ng m∆∞·ª£t
                await new Promise(r => setTimeout(r, 300));
            }

            // 3. X·ª¨ L√ù KHI TH·∫§T B·∫†I TO√ÄN T·∫¨P
            if (!success) {
                progressBox.style.display = 'none';
                status.style.display = 'none';
                btn.style.display = 'flex'; // Hi·ªán l·∫°i n√∫t
                btn.innerText = "üîÑ TH·ª¨ L·∫†I (HO·∫∂C CLICK ƒê·ªÇ T·∫†O TH·ª¶ C√îNG)";
                btn.onclick = () => {
                    // M·ªü trang t·∫°o link th·ªß c√¥ng n·∫øu auto h·ªèng
                    window.open(`https://link4m.co/api?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`, '_blank');
                };
                
                showError("‚ùå T·∫•t c·∫£ c·ªïng k·∫øt n·ªëi ƒë·ªÅu b·∫≠n. Vui l√≤ng b·∫•m n√∫t tr√™n ƒë·ªÉ h·ªá th·ªëng t·ª± chuy·ªÉn h∆∞·ªõng th·ªß c√¥ng.");
            }
        }

        function showError(msg) {
            const errBox = document.getElementById('errorDisplay');
            errBox.innerText = msg;
            errBox.style.display = 'block';
        }

        // --- LOGIC KEY ---
        function startKeyGen() {
            updateKey();
            setInterval(updateKey, 1000);
        }

        function updateKey() {
            const now = Math.floor(Date.now() / 1000);
            const duration = 180; 
            const timeStep = Math.floor(now / duration);
            const raw = SECRET + timeStep;
            const hash = CryptoJS.MD5(raw).toString();
            const num = parseInt(hash.substring(0, 8), 16) % 10000;
            document.getElementById("finalKey").innerText = "dat_" + num.toString().padStart(4, '0');
            document.getElementById("timeCount").innerText = duration - (now % duration);
        }

        function copyKey() {
            navigator.clipboard.writeText(document.getElementById("finalKey").innerText);
            alert("ƒê√£ sao ch√©p Key!");
        }
    </script>
</body>
</html>
