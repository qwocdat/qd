<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªÜ TH·ªêNG VIP KEY</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: #fff; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        .box { width: 350px; padding: 30px; border: 1px solid #333; border-radius: 20px; background: #111; text-align: center; box-shadow: 0 0 50px rgba(0, 255, 136, 0.1); }
        h2 { color: #00ff88; font-family: 'Orbitron'; margin-bottom: 5px; }
        .btn { width: 100%; padding: 15px; background: #fff; color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .btn:hover { background: #ccc; }
        .loader { border: 4px solid #333; border-top: 4px solid #00ff88; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status { color: #ffff00; font-size: 12px; margin-top: 10px; display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h2>H·ªÜ TH·ªêNG KEY</h2>
        <p style="color:#666; font-size:12px">cam on cac ban da su dung</p>
        <button id="btnGet" class="btn" onclick="generateSecureLink()">üëâ B·∫§M ƒê·ªÇ L·∫§Y KEY</button>
        <div id="loader" class="loader"></div>
        <div id="status" class="status">ƒêang kh·ªüi t·∫°o b·∫£o m·∫≠t...</div>
    </div>

    <script>
        const API_TOKEN = "6992df868b3d1e423d1ab833"; 
        const TARGET_FILE = "key.html"; 

        const PROXY_LIST = [
            (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
            (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`,
            (u) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
            (u) => `https://thingproxy.freeboard.io/fetch/${u}`
        ];

        async function generateSecureLink() {
            if (window.location.protocol === 'file:') return alert("L·ªói: H√£y upload l√™n GitHub Pages!");

            const btn = document.getElementById('btnGet');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');

            btn.style.display = 'none';
            loader.style.display = 'block';
            status.style.display = 'block';

            // 1. T·∫†O TOKEN B·∫¢O M·∫¨T (Ng·∫´u nhi√™n + Th·ªùi gian)
            const randomToken = Math.random().toString(36).substring(2) + Date.now().toString(36);
            const expiryTime = Date.now() + (5 * 60 * 1000); // Token s·ªëng 5 ph√∫t

            // 2. L∆ØU V√ÄO TR√åNH DUY·ªÜT (LocalStorage)
            localStorage.setItem('vip_token', randomToken);
            localStorage.setItem('vip_expiry', expiryTime);

            // 3. T·∫†O LINK ƒê√çCH K√àM TOKEN
            let currentPath = window.location.href.split('?')[0];
            if (currentPath.endsWith("index.html")) currentPath = currentPath.substring(0, currentPath.lastIndexOf("index.html"));
            if (!currentPath.endsWith("/")) currentPath += "/";
            
            // Link s·∫Ω c√≥ d·∫°ng: .../key.html?auth=abc123xyz
            const targetUrl = currentPath + TARGET_FILE + "?auth=" + randomToken;
            
            // 4. G·ªåI API LINK4M
            const link4mApi = `https://link4m.co/api-shorten/v2?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`;
            
            let success = false;
            for (let i = 0; i < PROXY_LIST.length; i++) {
                status.innerText = `ƒêang k·∫øt n·ªëi Server ${i+1}...`;
                try {
                    const controller = new AbortController();
                    setTimeout(() => controller.abort(), 5000);
                    const res = await fetch(PROXY_LIST[i](link4mApi), { signal: controller.signal });
                    if(!res.ok) throw new Error();
                    const data = await res.json();
                    
                    if (data.status === "success") {
                        status.innerText = "Th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...";
                        status.style.color = "#00ff88";
                        setTimeout(() => window.location.href = data.shortenedUrl, 800);
                        success = true;
                        break;
                    }
                } catch(e){}
                await new Promise(r => setTimeout(r, 200));
            }

            if (!success) {
                // Fallback th·ªß c√¥ng n·∫øu auto l·ªói
                window.open(`https://link4m.co/api?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`, '_blank');
            }
        }
    </script>
</body>
</html>
