<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG VIP KEY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: 'Inter', sans-serif; overflow: hidden; }
        .box { 
            text-align: center; width: 380px; padding: 30px; 
            border: 1px solid #333; border-radius: 20px; 
            background: linear-gradient(145deg, #111, #0a0a0a); 
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.1); 
        }
        h2 { color: #00ff88; font-family: 'Orbitron'; margin-bottom: 5px; }
        .btn { 
            width: 100%; padding: 15px; border: none; border-radius: 12px; 
            font-weight: bold; cursor: pointer; text-transform: uppercase; 
            font-size: 14px; margin-top: 20px;
            background: #fff; color: #000; box-shadow: 0 5px 15px rgba(255,255,255,0.1); 
            transition: 0.3s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255,255,255,0.2); }
        
        .progress-container { width: 100%; background: #222; height: 8px; border-radius: 4px; margin-top: 20px; overflow: hidden; display: none; }
        .progress-bar { height: 100%; background: #00ff88; width: 0%; transition: width 0.3s; }
        .status-text { color: #ffff00; font-size: 12px; margin-top: 10px; display: none; font-family: monospace; }
        .error-box { color: #ff5555; font-size: 12px; margin-top: 15px; padding: 10px; border: 1px solid #ff5555; background: rgba(255,0,0,0.1); display: none; }
    </style>
</head>
<body>

    <div class="box">
        <h2>VIP SYSTEM</h2>
        <p style="color:#888; font-size:13px">Link4M Auto-Gen v6.0 (Fix Verify)</p>

        <button id="btnGet" class="btn" onclick="handleGetLink()">üöÄ B·∫§M ƒê·ªÇ L·∫§Y KEY</button>
        
        <div id="progressBox" class="progress-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="status" class="status-text">ƒêang kh·ªüi t·∫°o...</div>
        <div id="errorDisplay" class="error-box"></div>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const API_TOKEN = "6992df868b3d1e423d1ab833"; 
        const TARGET_FILE = "key.html"; 
        // ----------------

        const PROXY_LIST = [
            (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
            (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`,
            (u) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
            (u) => `https://thingproxy.freeboard.io/fetch/${u}`
        ];

        async function handleGetLink() {
            if (window.location.protocol === 'file:') {
                showError("L·ªói: H√£y upload l√™n GitHub Pages!"); return;
            }

            const btn = document.getElementById('btnGet');
            const pBox = document.getElementById('progressBox');
            const pBar = document.getElementById('progressBar');
            const status = document.getElementById('status');
            const errBox = document.getElementById('errorDisplay');

            btn.style.display = 'none';
            errBox.style.display = 'none';
            pBox.style.display = 'block';
            status.style.display = 'block';
            pBar.style.width = '10%';

            // 1. T·∫†O LINK ƒê√çCH (ƒê√É S·ª¨A L·ªñI QUAN TR·ªåNG T·∫†I ƒê√ÇY)
            let currentPath = window.location.href.split('?')[0];
            if (currentPath.endsWith("index.html")) currentPath = currentPath.substring(0, currentPath.lastIndexOf("index.html"));
            if (!currentPath.endsWith("/")) currentPath += "/";
            
            // QUAN TR·ªåNG: Th√™m ?verify=true v√†o cu·ªëi link key.html
            // N·∫øu kh√¥ng c√≥ ƒëo·∫°n n√†y, file key.html s·∫Ω t·ª´ ch·ªëi truy c·∫≠p
            const targetUrl = currentPath + TARGET_FILE + "?verify=true";
            
            console.log("M·ª•c ti√™u:", targetUrl);

            // G·ªçi API Link4M (.co)
            const link4mApi = `https://link4m.co/api-shorten/v2?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`;
            
            let success = false;
            for (let i = 0; i < PROXY_LIST.length; i++) {
                status.innerText = `ƒêang k·∫øt n·ªëi Server ${i + 1}...`;
                pBar.style.width = `${((i + 1) / PROXY_LIST.length) * 100}%`;

                try {
                    const controller = new AbortController();
                    const id = setTimeout(() => controller.abort(), 5000);
                    const response = await fetch(PROXY_LIST[i](link4mApi), { signal: controller.signal });
                    clearTimeout(id);

                    if (!response.ok) throw new Error("HTTP Error");
                    const text = await response.text();
                    const data = JSON.parse(text);

                    if (data.status === "success" && data.shortenedUrl) {
                        pBar.style.width = '100%';
                        status.innerText = "‚úÖ Th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...";
                        status.style.color = "#00ff88";
                        setTimeout(() => window.location.href = data.shortenedUrl, 1000);
                        success = true;
                        break;
                    }
                } catch (e) { console.log("Fail server " + i); }
                await new Promise(r => setTimeout(r, 200));
            }

            if (!success) {
                pBox.style.display = 'none';
                status.style.display = 'none';
                btn.style.display = 'block';
                btn.innerText = "TH·ª¨ L·∫†I / T·∫†O TH·ª¶ C√îNG";
                btn.onclick = () => window.open(`https://link4m.co/api?api=${API_TOKEN}&url=${encodeURIComponent(targetUrl)}`, '_blank');
                showError("Server b·∫≠n. Vui l√≤ng b·∫•m n√∫t tr√™n ƒë·ªÉ t·∫°o th·ªß c√¥ng.");
            }
        }

        function showError(msg) {
            const e = document.getElementById('errorDisplay');
            e.innerText = msg; e.style.display = 'block';
        }
    </script>
</body>
</html>
