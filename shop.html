<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C·ª¨A H√ÄNG C√îNG C·ª§ | QUOCDAT SEC</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #00ff88; --bg: #0a0a0f; --card-bg: #15151e; --border: #2a2a35; --accent: #00b8ff; --vip: #f1c40f; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; min-height: 100vh; padding-bottom: 50px; }
        
        /* HEADER & NAVBAR */
        .header { background: rgba(0,0,0,0.8); padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .brand { font-family: 'Orbitron'; font-size: 20px; font-weight: 900; color: #fff; }
        .brand span { color: var(--primary); }
        .user-info { display: flex; gap: 15px; align-items: center; font-size: 14px; font-weight: bold; }
        .balance-badge { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px; color: var(--vip); border: 1px solid var(--vip); }
        
        /* T√åM KI·∫æM & B·ªò L·ªåC */
        .filter-section { max-width: 1000px; margin: 30px auto; padding: 0 20px; display: flex; gap: 15px; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 250px; position: relative; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #888; }
        .search-box input { width: 100%; background: var(--card-bg); border: 1px solid var(--border); color: #fff; padding: 15px 15px 15px 45px; border-radius: 12px; outline: none; font-size: 14px; transition: 0.3s; }
        .search-box input:focus { border-color: var(--primary); }
        .filter-box select { background: var(--card-bg); border: 1px solid var(--border); color: #fff; padding: 15px; border-radius: 12px; outline: none; font-size: 14px; cursor: pointer; min-width: 200px; }
        
        /* DANH S√ÅCH S·∫¢N PH·∫®M */
        .shop-grid { max-width: 1000px; margin: 0 auto; padding: 0 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px; text-align: center; transition: 0.3s; position: relative; overflow: hidden; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); border-color: var(--primary); }
        .p-icon { font-size: 40px; color: var(--accent); margin-bottom: 15px; }
        .p-name { font-family: 'Orbitron'; font-size: 18px; margin-bottom: 10px; color: #fff; }
        .p-desc { font-size: 12px; color: #888; margin-bottom: 20px; min-height: 36px; }
        
        /* C√ÅC LO·∫†I N√öT V√Ä GI√Å */
        .p-price { font-size: 18px; font-weight: bold; font-family: monospace; margin-bottom: 15px; }
        .price-free { color: var(--primary); }
        .price-vip { color: var(--vip); }
        
        .btn-action { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; font-family: 'Orbitron'; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .btn-link { background: #333; color: #fff; }
        .btn-link:hover { background: var(--accent); color: #000; }
        .btn-fast { background: #f1c40f; color: #000; }
        .btn-fast:hover { filter: brightness(1.2); }
        .btn-vip { background: var(--primary); color: #000; }
        .btn-vip:hover { filter: brightness(1.2); box-shadow: 0 0 15px rgba(0,255,136,0.3); }

        .badge-fast { position: absolute; top: 10px; right: -30px; background: #f1c40f; color: #000; font-size: 10px; font-weight: bold; padding: 5px 30px; transform: rotate(45deg); font-family: 'Orbitron'; }

        /* POPUP HI·ªÇN TH·ªä KEY */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);}
        .modal-box { width: 90%; max-width: 400px; background: #15151e; border-radius: 15px; border: 1px solid var(--primary); text-align: center; padding: 30px; }
        .key-display { font-family: 'Orbitron'; font-size: 24px; color: var(--vip); background: #000; padding: 15px; border-radius: 10px; border: 1px dashed var(--vip); margin: 20px 0; word-break: break-all; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">QUOCDAT<span>.SHOP</span></div>
        <div class="user-info" id="userArea">
            <span id="uName">Ch∆∞a ƒëƒÉng nh·∫≠p</span>
            <div class="balance-badge" id="uBal">0 ƒë</div>
        </div>
    </div>

    <div class="filter-section">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm t√™n ph·∫ßn m·ªÅm..." oninput="renderProducts()">
        </div>
        <div class="filter-box">
            <select id="filterSelect" onchange="renderProducts()">
                <option value="all">T·∫•t c·∫£ s·∫£n ph·∫©m</option>
                <option value="free_fast">‚ö° Mi·ªÖn ph√≠ (Nh·∫≠n Key Nhanh)</option>
                <option value="free_link">üîó Mi·ªÖn ph√≠ (C√†y V∆∞·ª£t Link)</option>
                <option value="paid">üíé S·∫£n ph·∫©m VIP (Tr·∫£ ph√≠)</option>
            </select>
        </div>
    </div>

    <div class="shop-grid" id="productGrid">
        <div style="text-align:center; color:#888; grid-column: 1/-1;">ƒêang t·∫£i d·ªØ li·ªáu c·ª≠a h√†ng...</div>
    </div>

    <div class="modal-overlay" id="keyModal">
        <div class="modal-box">
            <i class="fas fa-check-circle" style="font-size: 50px; color: var(--primary); margin-bottom: 15px;"></i>
            <h2 style="font-family:'Orbitron'; color:#fff; margin-bottom:10px;">TH√ÄNH C√îNG!</h2>
            <p style="color:#888; font-size:13px;">M√£ Key c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng. H√£y copy v√† d√°n v√†o C·ªïng Tr√≠ch Xu·∫•t.</p>
            
            <div class="key-display" id="modalKeyResult">---</div>
            
            <a href="download.html" class="btn-action btn-vip" style="display:inline-block; text-decoration:none; margin-bottom:10px;">T·ªöI C·ªîNG TR√çCH XU·∫§T NGAY</a>
            <button class="btn-action btn-link" onclick="document.getElementById('keyModal').style.display='none'">ƒê√ìNG L·∫†I</button>
        </div>
    </div>
        <script>
        const fbConfig = { apiKey: "AIzaSyAWaCeduRtSP74OkRYJ6wvw8LPPkoLGsGc", databaseURL: "https://quocdat-b80c2-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "quocdat-b80c2" };
        if (!firebase.apps.length) firebase.initializeApp(fbConfig);
        const db = firebase.database();

        let allProducts = {};
        
        // 1. KI·ªÇM TRA ƒêƒÇNG NH·∫¨P V√Ä S·ªê D∆Ø
        const username = localStorage.getItem('vip_username'); // Gi·∫£ ƒë·ªãnh key l∆∞u t√™n user c·ªßa √¥ng
        let safeUid = username ? username.replace(/[.#$\[\]]/g, '_') : null;
        let currentBalance = 0;

        if(safeUid) {
            document.getElementById('uName').innerText = username;
            db.ref('users/' + safeUid + '/balance').on('value', snap => {
                currentBalance = snap.val() || 0;
                document.getElementById('uBal').innerText = Number(currentBalance).toLocaleString('vi-VN') + " ƒë";
            });
        } else {
            document.getElementById('userArea').innerHTML = `<a href="index.html" style="color:var(--primary); text-decoration:none;">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</a>`;
        }

        // 2. T·∫¢I D·ªÆ LI·ªÜU S·∫¢N PH·∫®M V√Ä RENDER
        db.ref('products').on('value', snap => {
            allProducts = snap.val() || {};
            renderProducts();
        });

        function renderProducts() {
            let grid = document.getElementById('productGrid');
            let filter = document.getElementById('filterSelect').value;
            let search = document.getElementById('searchInput').value.toLowerCase();
            let html = '';

            for(let id in allProducts) {
                let p = allProducts[id];
                
                // L·ªçc theo t√¨m ki·∫øm
                if(search && !p.name.toLowerCase().includes(search)) continue;

                let isFree = (p.price === 0 || !p.price);
                let isInstant = p.is_instant === true;

                // L·ªçc theo danh m·ª•c
                if(filter === 'paid' && isFree) continue;
                if(filter === 'free_link' && (!isFree || isInstant)) continue;
                if(filter === 'free_fast' && (!isFree || !isInstant)) continue;

                // T·∫°o giao di·ªán t·ª´ng th·∫ª
                let badge = isInstant && isFree ? `<div class="badge-fast">FAST</div>` : '';
                let icon = p.img || 'fas fa-box';
                let priceHtml = '';
                let btnHtml = '';

                if (!isFree) {
                    priceHtml = `<div class="p-price price-vip">${Number(p.price).toLocaleString('vi-VN')} ƒë</div>`;
                    btnHtml = `<button class="btn-action btn-vip" onclick="buyVIP('${id}')"><i class="fas fa-shopping-cart"></i> MUA B·∫∞NG S·ªê D∆Ø</button>`;
                } else if (isInstant) {
                    priceHtml = `<div class="p-price price-vip" style="color:#f1c40f;">MI·ªÑN PH√ç</div>`;
                    btnHtml = `<button class="btn-action btn-fast" onclick="getFastKey('${id}')"><i class="fas fa-bolt"></i> NH·∫¨N KEY NHANH</button>`;
                } else {
                    priceHtml = `<div class="p-price price-free">MI·ªÑN PH√ç</div>`;
                    btnHtml = `<button class="btn-action btn-link" onclick="window.location.href='getkey.html'"><i class="fas fa-link"></i> V∆Ø·ª¢T LINK L·∫§Y KEY</button>`;
                }

                html += `
                    <div class="product-card">
                        ${badge}
                        <i class="${icon} p-icon"></i>
                        <h3 class="p-name">${p.name}</h3>
                        <p class="p-desc">${p.desc || 'C√¥ng c·ª• si√™u c·∫•p vip pro.'}</p>
                        ${priceHtml}
                        ${btnHtml}
                    </div>
                `;
            }

            if(html === '') html = `<div style="text-align:center; color:#888; grid-column: 1/-1;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</div>`;
            grid.innerHTML = html;
        }

        // 3. X·ª¨ L√ù: MUA VIP (TR·ª™ TI·ªÄN)
        async function buyVIP(id) {
            if(!safeUid) return alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ mua h√†ng!");
            
            let p = allProducts[id];
            if(currentBalance < p.price) return alert(`B·∫°n kh√¥ng ƒë·ªß ti·ªÅn! C·∫ßn ${Number(p.price).toLocaleString('vi-VN')} ƒë. Vui l√≤ng n·∫°p th√™m.`);

            if(confirm(`X√°c nh·∫≠n mua [${p.name}] v·ªõi gi√° ${Number(p.price).toLocaleString('vi-VN')} ƒë?`)) {
                // Tr·ª´ ti·ªÅn
                await db.ref('users/' + safeUid + '/balance').set(currentBalance - p.price);
                
                // T·∫°o Key VIP
                let keyStr = "VIP-" + Math.random().toString(36).substring(2, 10).toUpperCase();
                let exp = Date.now() + (30 * 24 * 60 * 60 * 1000); // M·∫∑c ƒë·ªãnh mua VIP cho h·∫°n 30 ng√†y
                
                await db.ref('transactions').push().set({
                    user: username, type: 'vip_purchase', amount: p.price,
                    detail: 'Mua VIP: ' + p.name, key_granted: keyStr,
                    download_link: p.download_link, expiry_at: exp, time: new Date().toISOString(),
                    used: false, color: '#00ff88'
                });

                showKeyModal(keyStr);
            }
        }

        // 4. X·ª¨ L√ù: NH·∫¨N KEY NHANH (KH√îNG C·∫¶N LINK)
        async function getFastKey(id) {
            let p = allProducts[id];
            let keyStr = "FAST-" + Math.random().toString(36).substring(2, 8).toUpperCase();
            let exp = Date.now() + 1200000; // H·∫°n 20 ph√∫t

            await db.ref('transactions').push().set({
                user: username || 'Guest', type: 'free_fast', amount: 0,
                detail: 'Nh·∫≠n nhanh: ' + p.name, key_granted: keyStr,
                download_link: p.download_link, expiry_at: exp, time: new Date().toISOString(),
                used: false, color: '#f1c40f'
            });

            showKeyModal(keyStr);
        }

        function showKeyModal(key) {
            document.getElementById('modalKeyResult').innerText = key;
            document.getElementById('keyModal').style.display = 'flex';
        }
    </script>
</body>
</html>
